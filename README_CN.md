### **行布局算法**

**目标：**

- **保持图片比例**：不拉伸或压缩图片，保持原始宽高比。
- **行高一致性**：让每一行的高度尽可能接近我们设定的**目标行高**（例如300像素）。
- **充分利用空间**：使每一行的照片刚好填满容器的宽度（例如1000像素），避免空白区域。

---

### **算法步骤**

#### **1. 收集照片信息**

- **每张照片的宽高比**：这是照片的宽度除以高度。
  - **示例**：一张照片宽600像素，高400像素，宽高比就是600 ÷ 400 = **1.5**。

#### **2. 考虑可能的照片组合**

- **可能的行组合**：我们尝试将照片以不同的方式组合成一行，例如：
  - 行1：照片1
  - 行2：照片1和照片2
  - 行3：照片1、照片2和照片3
  - 行4：照片2和照片3
  - **等等**

#### **3. 计算每个可能行的高度**

对于每一种照片组合，我们按照以下步骤计算该行的高度：

1. **计算总宽高比**

   - **总宽高比**是这一行中所有照片的宽高比之和。
     - **示例**：如果行中有照片1（宽高比1.5）和照片2（宽高比1.0），那么总宽高比就是1.5 + 1.0 = **2.5**。

2. **计算行高**

   - **行高**等于容器宽度除以总宽高比。
     - **示例**：容器宽度为1000像素，行高 = 1000 ÷ 2.5 = **400像素**。

3. **评估行高与目标行高的差异**

   - **差异值**：行高减去目标行高，表示该行高度与我们期望的高度有多大的差异。
     - **示例**：目标行高为300像素，差异值 = 400 - 300 = **100像素**。

   - **注意**：我们希望这个差异越小越好，表示行高越接近目标行高。

#### **4. 为每个可能的行组合计算“代价”**

- **代价的概念**：代价表示使用该照片组合形成一行的“成本”，即行高与目标行高的差异程度。

- **计算代价的方法**：
  - 我们通常使用差异值的平方来表示代价，因为：
    - 差异的平方始终是正数，便于比较。
    - 对于差异较大的情况，平方会放大代价，避免选择这些组合。

- **示例**：
  - 差异值为100像素，代价 = 100² = **10,000**。
  - 差异值为-50像素（行高低于目标行高），代价 = (-50)² = **2,500**。

#### **5. 找到最优的照片排列方式**

- **核心思想**：通过计算所有可能的行组合的代价，我们可以找到总代价最小的照片排列方式。
  - **总代价**：所有行的代价之和。

- **实现方法**：
  - **逐一尝试**：虽然可能的组合很多，但通过算法，我们可以有效地计算并比较它们。
  - **选择代价最小的路径**：最终选择那些行高与目标行高最接近的组合方式。

#### **6. 调整照片尺寸并渲染**

- **计算每张照片的显示宽度**：

  - **显示宽度** = 行高 × 照片的宽高比。
    - **示例**：行高为400像素，照片的宽高比为1.5，显示宽度 = 400 × 1.5 = **600像素**。

- **渲染照片**：

  - 将计算好的尺寸应用到照片上，保持比例，并排列在一行内。

---

### **举个具体的例子**

假设我们有以下5张照片：

| 照片编号 | 宽高比 |
|---------|--------|
| 照片1    | 1.5    |
| 照片2    | 1.0    |
| 照片3    | 1.2    |
| 照片4    | 0.8    |
| 照片5    | 1.4    |

**容器宽度**：1000像素

**目标行高**：300像素

**步骤**：

1. **尝试不同的行组合**：

   - **组合1**：照片1、2和3

     - 总宽高比：1.5 + 1.0 + 1.2 = **3.7**
     - 行高：1000 ÷ 3.7 ≈ **270像素**
     - 差异值：270 - 300 = **-30像素**
     - 代价：(-30)² = **900**

   - **组合2**：照片4和5

     - 总宽高比：0.8 + 1.4 = **2.2**
     - 行高：1000 ÷ 2.2 ≈ **455像素**
     - 差异值：455 - 300 = **155像素**
     - 代价：(155)² = **24,025**

2. **比较代价**：

   - 组合1的代价为900，组合2的代价为24,025。
   - 显然，组合1更接近目标行高。

3. **确定最佳排列**：

   - 我们可能选择将照片1、2、3放在第一行，照片4、5放在第二行。
   - 总代价为900（第一行） + 24,025（第二行） = **24,925**。

4. **尝试其他组合**：

   - 如果我们尝试将照片1和2放在第一行，照片3、4、5放在第二行，可能得到更小的总代价。

5. **最终选择**：

   - 经过比较，我们选择总代价最小的照片排列方式。

---

### **关键点总结**

- **代价越小**，表示行高越接近目标行高，布局越理想。
- **平方代价**，对偏差较大的情况有更大的惩罚，促使算法选择高度更均衡的行。
- **保持宽高比**，确保照片不变形，呈现最佳视觉效果。

---

### **为什么要这样做？**

- **用户体验**：行高一致的照片墙看起来更整齐、美观，提升用户的浏览体验。
- **性能优化**：通过算法计算，自动找到最佳的照片排列方式，省去手动调整的麻烦。
- **适应不同尺寸的照片**：无论照片的宽高比如何，都能自动调整，形成协调的布局。